"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(t,e,a,i){var s={init:function(a,i){var s=this;s.elem=i,s.setElem(),s.settings=t.extend({},t.fn.listpage2.options,a),"[object Array]"===Object.prototype.toString.call(s.settings.options)&&(s.settings.options={}),s.data={total:0,options:s.settings.options||{},url:s.settings.url},t.each(s.$elem.find(".active[data-action-click=filter]"),function(){var e=t.trim(t(this).data("value"));e&&(s.data.options[t.trim(t(this).data("name"))]=e)}),t.each(s.$elem.find("[data-action-change=filter]"),function(){var e=t(this).prop("checked")?1:0;e&&(s.data.options[t(this).attr("name")]=e)}),s.resize(),t(e).resize(function(){s.resize()}),s.$elem.addClass("on"),s.ids={},s.Events()},setElem:function(){var e=this;e.$elem=t(e.elem),e.$elem.find("[ref]").each(function(){if(t(this).attr("ref")){var a="$"+t(this).attr("ref");e[a]=t(this)}}),t.each(e.$elem.find("[plugin=dropdown]"),function(){var a=t.parseJSON(t(this).attr("data-options"));a.onClick=function(a){e.action(t(a).attr("ajaxify"))},t(this).dropdown(a)})},resize:function(){var a=this;if(!t("#doc").hasClass("fixed_elem")){var i=t(e),s=a.$elem.offset(),n=0,o=i.width()-(s.left+n),l=(i.height(),0);t("body").hasClass("hasTopbar")&&(l=t("#header-primary").height());var r=0;a.$header&&(r=a.$header.outerHeight(),a.$header.css({top:l,left:s.left,width:o-16,position:"fixed"})),a.$elem.find(".listpage2-table-overlay-warp").css({left:s.left}),a.$table.css({paddingTop:r}),a.$tabletitle.css({position:"fixed",left:s.left,right:n,zIndex:20}),a.$tablelists.css({marginTop:a.$tabletitle.outerHeight()});var d=0;if(a.$tablelists.find("table tr:first>td").hasClass("empty"))return!1;a.$tablelists.find("table tr:first>td").each(function(e){var i=t(this),s=a.$tabletitle.find("table th[data-col="+e+"]");if(!i.hasClass("name")){var n=i.outerWidth(),o=i.width();s.width()>o&&(n=s.outerWidth(),o=s.width()),d+=n,i.width(o),s.width(o)}}),d>0&&a.$tablelists.find("td.name .ellipsis").length&&(d+=parseInt(a.$tablelists.find("td.name").css("padding-left")),d+=parseInt(a.$tablelists.find("td.name").css("padding-right")),a.$tablelists.find("td.name .ellipsis").css("max-width",o-d)),a.$table.hasClass("has-empty")?(a.$tabletitle.css("padding-right",0),a.$table.find(".listpage2-table-empty").css("padding-top",a.$tabletitle.outerHeight()+r)):a.$tabletitle.css("right",a.$tabletitle.outerWidth()-a.$tablelists.find("table").outerWidth())}},Events:function(){var e=this;e.$elem.mouseover(function(){e.resize()}),t("input#checkboxes",e.$tabletitle).change(function(a){a.preventDefault(),e.selection(t(this).is(":checked"),"all")}),e.$elem.delegate("input#toggle_checkbox","change",function(a){a.preventDefault(),e.selection(t(this).is(":checked"),t(this).parents("tr"))}),t(".navigation-trigger").click(function(t){e.resize()}),e.$elem.find(".js-refresh").click(function(t){e.refresh(200),t.preventDefault()}),e.$elem.find("#more-link").delegate("a.next, a.prev","click",function(a){pager=parseInt(e.data.options.pager),pager+=t(this).hasClass("prev")?-1:1,e.data.options.pager=pager,e.refresh(1),a.preventDefault()}),e.$elem.delegate("[ajaxify]","click",function(a){a.preventDefault(),e.action(t(this).attr("ajaxify"))}),t("a.link-sort",e.$tabletitle).click(function(a){var i=t(this).attr("data-sort")||"asc";i="asc"==i?"desc":"asc",t(this).attr("data-sort",i),e.data.options.dir=i,e.data.options.sort=t(this).attr("data-sort-val"),e.refresh(1),e.$tabletitle.find(".sorttable.asc").removeClass("asc"),e.$tabletitle.find(".sorttable.desc").removeClass("desc"),t(this).parent().addClass(i),a.preventDefault()}),e.$elem.find("select[ref=selector]").length>0&&t.each(e.$elem.find("select[ref=selector]"),function(){t(this).attr("name")&&(e.data.options[t(this).attr("name")]=t(this).val())});var a=e.$elem.find("[ref=closedate]"),s=e.$elem.find(":input[ref=date]");if(1==a.length){var n=[],o=0;t.each(a.find("option"),function(e){t(this).prop("selected")&&(o=e);var a=t(this).attr("divider");typeof a!=typeof i&&a!==!1?n.push({divider:!0}):n.push({value:t(this).attr("value")?t(this).attr("value"):t(this).text(),text:t(this).text()})}),n.length>0?a.closedate({onComplete:function(t){},onChange:function(t){var a=t.$menu.find("li.active").data();""==a.value?(delete e.data.options.period_start,delete e.data.options.period_end):(e.data.options.period_start=t.startDateStr,e.data.options.period_end=t.endDateStr),e.refresh(1)},options:n,activeIndex:o}):e.refresh(1)}else 1==s.length?s.datepicker({onSelected:function(t){e.data.options.date=PHP.dateJStoPHP(t),e.data.options.pager=1,e.refresh(1)},onComplete:function(t){e.data.options.date=PHP.dateJStoPHP(t),e.refresh(1)}}):e.refresh(1);e.$elem.find(".search-input").keydown(function(a){var i=t.trim(t(this).val());13==a.keyCode&&""!=i&&e.search(i)}).keyup(function(a){var i=t.trim(t(this).val());""==i&&i!=e.data.options.q&&e.search(i)}),e.$elem.find(".form-search").submit(function(a){var i=t.trim(t(this).find(".search-input").val());""!=i&&e.search(i),a.preventDefault()}),e.$header&&(e.$header.find("select[ref=selector]").change(function(){e.data.options.pager=1,e.data.options[t(this).attr("name")]=t(this).val(),e.refresh(1)}),e.$header.find("[data-action-click=filter]").click(function(a){a.preventDefault(),e.data.options.pager=1,e.data.options[t(this).data("name")]=t(this).data("value"),t(this).addClass("active").siblings().removeClass("active"),e.refresh(1)}),e.$header.find("[data-action-change=filter]").change(function(a){a.preventDefault(),e.data.options.pager=1,e.data.options[t(this).attr("name")]=t(this).prop("checked")?1:0,e.refresh(1)})),e.$elem.find("select[role=choose]").change(function(){t(this).data("options")?t.each(t.parseJSON(t(this).attr("data-options")),function(t,a){e.chooseSelect(a)}):e.chooseSelect(t(this).data())})},chooseSelect:function(e,a){var i=this,s=i.$elem.find("select[name="+e.id+"]"),n={};t.each(i.$elem.find("select[role=choose][data-id="+e.id+"]"),function(e,a){n[t(this).attr("name")]=t(this).val()}),t.get(e.url,n,function(e){s.empty();var a=0,i=t.map(e,function(e){return a+=parseInt(e.count),t("<option>",{value:e.id,text:e.name+(e.count?" ("+e.count+")":"")})[0]});s.append(t("<option>",{value:"",text:"All"}),i)},"json")},search:function(t){var e=this;e.data.options.pager=1,e.data.options.q=t,e.is_search=!0,e.refresh(500)},setSelectedDate:function(){},selection:function(e,a){var i=this;"all"==a?t.each(i.$tablelists.find("tr"),function(a,s){var n=t(this);1!=e||n.hasClass("has-checked")?0==e&&n.hasClass("has-checked")&&i.cancelItem(n):i.selectItem(n)}):e?i.selectItem(a):i.cancelItem(a)},selectItem:function(t){var e=this,a=t.find("input#toggle_checkbox"),i=t.attr("data-id");a.prop("checked",!0),t.addClass("has-checked"),e.ids[parseInt(i)]=t,e.active()},cancelItem:function(t){var e=this,a=t.find("input#toggle_checkbox"),i=t.attr("data-id");a.prop("checked",!1),t.removeClass("has-checked"),delete e.ids[parseInt(i)],e.active()},active:function(){var t=this,e=Object.keys(t.ids).length;e>0?(t.$actions.addClass("hidden_elem"),t.$selection.removeClass("hidden_elem").find(".count-value").text(e)):(t.$selection.addClass("hidden_elem").find(".count-value").text(""),t.$tabletitle.find("input#checkboxes").prop("checked",!1),t.$actions.removeClass("hidden_elem")),t.resize()},refresh:function(e){var a=this;return a.is_loading&&clearTimeout(a.is_loading),a.$elem.addClass("has-loading"),a.data.url?void(a.is_loading=setTimeout(function(){a.fetch().done(function(e){if(a.$tablelists.parent().hasClass("has-error")&&a.$tablelists.parent().removeClass("has-error"),e.settings.total===!1)return a.$tablelists.parent().addClass("has-error"),Event.showMsg({text:"Data Error"}),!1;if(Event.hideMsg(),a.data=t.extend({},a.data,e.settings),a.$tablelists.parent().toggleClass("has-empty",0==parseInt(a.data.total)?!0:!1),a.setMore(),e.selector&&a.setSelector(e.selector),a.data.options.sort){var i=a.data.options.dir.toLowerCase();sort=a.data.options.sort.split(","),sort=sort[0].split(" "),a.$tabletitle.find("[data-sort-val="+sort[0]+"]").attr("data-sort",a.data.options.dir).parent().removeClass("desc"==i?"asc":"desc").addClass(i)}a.display(e.body)})},e||1)):!1},fetch:function(){var e=this;return e.is_search&&e.$elem.find(".search-input").attr("disabled",!0),t.ajax({url:e.data.url,data:e.data.options,dataType:"json"}).always(function(){e.$elem.removeClass("has-loading"),e.is_search&&(e.$elem.find(".search-input").attr("disabled",!1),e.$elem.find(".search-input").focus(),e.is_search=!1)}).fail(function(){e.$elem.addClass("has-error")})},display:function(e){var a=this;$item=t(e),a.$tablelists.html(e),a.resize(),Event.plugins(a.$tablelists),a.$elem.hasClass("offline")&&a.$elem.removeClass("offline")},setMore:function(){var e=this,a=e.data.options,i=e.data.total,s=a.pager,n=a.limit;if(e.$elem.find("#more-link").empty(),0==i)return e.$elem.find("#more-link").addClass("hidden_elem"),!1;e.$elem.find("#more-link").hasClass("hidden_elem")&&e.$elem.find("#more-link").removeClass("hidden_elem");var o=parseInt(i/n);i%n&&o++;var l=n*s-n+1,r=n*s;r>i&&(r=i),e.$elem.find("#more-link").append(t("<span>",{"class":"mhs"}).append(l,"-",r,t("<span>",{"class":"mhs",text:"จาก"}),PHP.number_format(i)),s>1?t("<a>",{"class":"prev"}).html(t("<i>",{"class":"icon-angle-left"})):t("<span>",{"class":"prev disabled fcg"}).html(t("<i>",{"class":"icon-angle-left"})),s==o?t("<span>",{"class":"next disabled fcg"}).html(t("<i>",{"class":"icon-angle-right"})):t("<a>",{"class":"next"}).html(t("<i>",{"class":"icon-angle-right"})))},setSelector:function(e){var a=this;t.each(e,function(e,i){$item=a.$elem.find("select[ref=selector][name="+e+"]"),$item&&($item.empty(),t.each(i,function(e,a){$item.append(t("<option>",{text:a.text+(a.total>0?" ("+a.total+")":""),value:e,selected:a.current}))}))})},action:function(t){var e=this;if(0==Object.keys(e.ids).length)return!1;var a=[];for(var i in e.ids){e.ids[i];a.push(i)}Dialog.load(t,{ids:a,callback:1},{onSubmit:function(t){var a=t.$pop.find("form");a.hasClass("js-print")?(e.print(a),e.selection(!1,"all"),Dialog.close()):Event.inlineSubmit(a).done(function(t){Event.processForm(a,t)})},onOpen:function(){},onClose:function(){}})},print:function(a){var i=3.779528,s=t(e).height(),n=210*i,o="status=0,title=0,scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width="+n+",height="+s+",left=0,top=0",l=a[0];map=e.open("","_print",o),map?(l.submit(),Dialog.close()):alert("You must allow popups for this map to work.")}};t.fn.listpage2=function(e){return this.each(function(){var a=Object.create(s);a.init(e,this),t.data(this,"listpage2",a)})},t.fn.listpage2.options={options:{pager:1}}}(jQuery,window,document);